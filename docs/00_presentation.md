## 通しのスクリプト

はじめまして。株式会社グッドパッチでエンジニアをしている藤井です。よろしくお願いします。

---

さて、今年 9 月に iOS / iPadOS 他 26、リリースされましたね。
この中で目玉だったのが

---

Liquid Glass です。

---

みなさんは、Liquid Glass 使えてますかね？
かっこいい、見にくい、ユーザーとしてはさまざまな意見があると思います。
Flutter ではどうでしょうか？

---

WWDC で発表された当時はこんな話が SNS を駆け巡りました。
Liquid Glass で Flutter の危機だ、と。
それに対する Flutter のアンサーはこちらの issue だったかなと思います。

---

YOUTRUST のルーカスさんが立ててくださった issue です。
こちら大いに盛り上がって、さまざまな意見・ソリューションが出ていたかなと思います。

---

では、ここでそもそも Liquid Glass とは何なのか？を考えてみましょう。

---

詳細は自分が 10 月に書いたブログを読んでほしいのですが、要点だけ紹介すると、

---

Liquid Glass はコンテンツ層とナビゲーション・コントロール層を分離するための表現手法となっていて

---

実際に HIG に二項目にわたって関連する記述があります。
コンテンツレイヤーでは使わず、控えめにするということですね。

---

つまりこういったコントロール類に使うのはいいのですが、

---

こんな感じで装飾に使っちゃうのは非推奨です。重ねるなんてもってのほかですね。

---

繰り返しになりますが、Liquid Glass はコンテンツ層で使うべきではありません。

---

さらにですね、Liquid Glass はそれだと見にくいという弱点がありますが、それを補うためちゃんとアクセシビリティ設定で見やすく調整できる機能を備えています。

---

つまりこれらをふまえると、Flutter で Liquid Glass をちゃんと扱うのはあまりにも難しいということになります。
見た目の再現では乱用を招いてしまいますし、アクセシビリティ設定やアップデートによる調整も追いきれません。

---

そこでこう考えてみました。Flutter はでンテンツ層であると割り切ればいいのではないか、と。

---

Flutter がコンテンツ層でナビゲーション・コントロール層をネイティブに任せるというわけですね。

---

図にするとこんな感じです。
そしてこれを実現する技術がありました。

---

Add-to-app です。

---

というわけで実際どうなったのかデモをお見せしながら、簡単に紹介していきます。

---

まず全体の繋ぎこみとしては Pigeon を用いてホストと Flutter の二つの API を定義しています。

---

データの読み込みは Flutter から HostAPI の getItems を呼び出してデータを受け取り表示します。

---

toggleShowAddSheet などの関数では SwiftUI の State を操作することで画面遷移を起こすことにも成功しました。

---

こちらでデータを操作して、データが更新されたのちは Swift 側から Flutter の onItemsUpdated を呼び出して、Flutter の getItems 呼び出しを促しています。これによって即時データが更新されます。

---

この仕組みは Flutter 側からボタンを押しても同じで、変更リクエストを投げて、更新リクエストを受け取る感じですね。

---

さらに Flutter 画面を遷移する時には FlutterEngineGroup を使うことで同時に複数の Flutter 画面を動かすことで実現してます。

---

仕組みとしてはこんな感じです。
これをみたらすごく感じるかと思うんですが

---

ややこしいです。でも動きました。

---

ちなみに今はナビゲーションを主にネイティブにしていたのですが、コントロール類も cupertino_native や adaptive_platform_ui などのライブラリがすでに出ているのでこちらを活用するのが良さそうです。

---

ただ、例えばナビゲーションのタイトルなどは連携が難しく、Cupertino にないスタイルが出始めているので対応しきれない箇所ももちろんあるというところです。

---

まとめると、大事なこととして Liquid Glass は装飾ではありません。その上で対応するにあたって Flutter をコンテンツ層だと割り切ることに成功しました。

---

一方で Add-to-app はやはり多用するものではないなと感じました。これなら多分 SwiftUI で全部作ったほうが楽です。でも可能性の一つとしては面白いのかなと思います。

---

というわけで、今回のプレゼンを終えるというタスクを完了にして、以上で発表を終わります。ありがとうございました。
