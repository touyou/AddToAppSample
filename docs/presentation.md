## タイトル

こんにちは。株式会社グッドパッチでデザインエンジニアをしている藤井です。よろしくお願いします。

## Liquid Glass について

さっそく本題に入っていきたいんですが、みなさん、特に iPhone ユーザーの方は最新 iOS にアップデートしましたか？
Liquid Glass どうでしょうか？

WWDC でリリースされて以来、Flutter でも話題になったかなと思います。
ライバルでもある React Native で爆速に対応されたことがキッカケに、Flutter は終わりだという論調が出てきたことも記憶に新しいのではないでしょうか？

そんな中、YOUTRUST のルーカスさんが issue を立ててくださったおかげで Flutter でも様々な人が対応方法を考え、結果様々なソリューションが出てきましたね。
https://tech.youtrust.co.jp/entry/liquid-glass-in-flutter

素晴らしい動きですよね。
ですが、これだけ素晴らしい動きなのですが一つだけ問題があります。

## Liquid Glass を Flutter で実装するということ

そもそも Liquid Glass とはどのようなものなのでしょうか？
詳しくは自分が 10 月に書いたブログを読んでほしいのですが、要点だけ紹介します。
https://goodpatch-tech.hatenablog.com/entry/liquid_glass_and_app_intents

それは何かというと Liquid Glass はコンテンツ層とナビゲーション・コントロール層を分離するための表現手法であり、決して装飾のためのものではないということです。
これは HIG にも明記されています。

具体例で言うと、このようにタブやツールバーであったり、ユーザーが操作する際の一時的な表現として Liquid Glass を使うのはいいのですが、
カードの背景に使うとか、視覚表現のために使うのは原則 NG です。

Flutter で再現するのだとすると、このような制約、そして iOS 側のアクセシビリティ設定がしっかりと反映されるようにしなければなりませんが、これを見た目だけ模倣したライブラリで行うのは現実的ではありません。
じゃあどうするか？

ここで自分は、「だったら Flutter をコンテンツ層にして、Liquid Glass はネイティブに任せるのはどうなのか？」と思いました。そう Add-to-app の応用です。

## デモ

では早速どこまでできたのか、みていきましょう。
こちらが実際の画面です。簡単な TODO アプリを作ってみました。

構成としては、コントロール・ナビゲーション層を SwiftUI で、コンテンツ層のみを Flutter で実装しています。

データの連携には Pigeon を使いました。まずデータを Flutter から取れるような API を用意して、Flutter 側で表示しています。
続いて、こちらの FAB を押すと、SwiftUI 側に通知してモーダルシートが表示されるようになっています。

こちらで入力して保存をした後に、Flutter 側に通知する関数を呼び出して、Flutter は再度 SwiftUI 側にデータを取りにいきます。

いいねや DONE のチェックを押した時には Flutter 側からデータを更新する API を呼び出して、SwiftUI 側でデータを更新しています。
そして他の画面に伝播させるため、更新メソッドを呼び出してあげます。こうすることで、マルチエンジンでもデータの一貫性を保つことができます。

そしてパラメータを渡した遷移も、onGenerateRoute を使うことで実現しています。initialRoute にパラメータを含めたパスを渡してあげるだけです。

これはもちろん SwiftUI 側から呼び出しても使えます。

上手く組み合わせれば新しい検索タブもしっかり動きます。

ざっとこんなところでしょうか。最後に制約です。

まず今まで見てきたように非常にデータのやり取りが多くなります。Add-to-app の注意点ではあるのですが、あまり本番運用するのは非現実的かなと思いました。
また iOS26 から inlineLarge というスタイルが一般的になりましたが、これに対応することが難しかったです。
タブ間をみるとわかるのですが、ネイティブでタイトルをつけて Flutter 側をリストだけにしてもすでにスクロールしてしまってる判定になって上手くいきませんでした。
Flutter 側で AppBar をつけると inlineLarge の見た目はまだ用意されていないので、自作する必要があります。
全て SwiftUI だとちゃんと上手く動くのでここは何某か考える必要がありそうですね。

ですが、それ以外は少なくとも今回触った限りだと大きな問題はありませんでした。Switch などでも使いたければ PlatformView を活用したライブラリなどを検討するのが良さそうです。

## まとめ

駆け足でしたが、Flutter で Liquid Glass をちゃんと対応するために、Add-to-app を使うとどうなんだという挑戦をしてみました。
結果としては、ある程度の制約はあるものの、実現可能であることがわかりました。
正直 Flutter である旨みがほぼほぼゼロになってしまったのですが、こういったやり方を考えてみるというのも一つの手かなと思います。

何はともあれ、ぜひ Liquid Glass の本質を今日は理解して、Flutter はどうするのか？を考えるキッカケになれば幸いです。
ご清聴ありがとうございました。
